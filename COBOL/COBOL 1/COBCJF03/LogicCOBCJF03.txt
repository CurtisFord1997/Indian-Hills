//COBCJF03

//FILE VARS
FILE INPUT1 = CBLBOAT1.DAT
FILE OUTPUT1 = BOATRPT2.PRT

//input variables
STRING I-REC
	STRING I-LAST-NAME, I-STATE
	DOUBLE I-BOAT-COST
	STRING I-DATE
		INTEGER I-YYYY,I-MM,I-DD
	STRING I-BOAT-TYPE
	INTEGER I-ACCESSORY-PACKAGE
	DOUBLE I-PREP-DELIVER-COST
	
//CONSTANT VARS
DOUBLE TAX-RATE

//CALC VARS
STRING C-BOAT-TYPE, C-ACCESSORY-PACKAGE
DOUBLE C-TOTAL-COST,  COST-ACCESSORY-PACKAGE, C-MARKUP-PRCNT //C-TAX-AMT
INTEGER C-PG-NUM = 0
BOOLEAN EOF = FALSE

//MINOR SUB VARS
INTEGER C-MINOR-NUM-SOLD
DOUBLE C-MINOR-TOTAL-COST

//MAJ SUB VARS
INTEGER C-MAJOR-NUM-SOLD = 0
DOUBLE C-MAJOR-TOTAL-COST = 0

//GRAND TOTALS VARS
INTEGER C-GT-NUM-SOLD = 0
DOUBLE C-GT-TOTAL-COST = 0

//Heald VARS
STRING HEALD-DATA
	STRING H-BOAT-TYPE 

//OUTPUT VAR
STRING COMPANY-TITLE-NAME 
	INTEGER TITLE-MM, TITLE-DD, TITLE-YYYY, TITLE-PG
	
STRING DATA-LINE
	STRING DAT-LAST-NAME, DAT-STATE, 
	DOUBLE DAT-BOAT-COST
	INTEGER DAT-MM, DAT-DD, DAT-YY
	STRING DAT-ACCESSORY-PACKAGE
	DOUBLE DAT-PREP-DELIVER-COST, DAT-TOTAL-COST
	
STRING BOAT-TYPE-HEADER-LINE
	STRING BOAT-HEADER 
	
STRING BOAT-MINOR-LINE
	STRING MINOR-STATE
	STRING MINOR-BOAT-TYPE
	INTEGER MINOR-NUM-SOLD
	DOUBLE MINOR-TOTAL-COST
	
STRING BOAT-MAJOR-LINE
	STRING MAJOR-BOAT-TYPE
	INTEGER MAJOR-NUM-SOLD
	DOUBLE MAJOR-TOTAL-COST
	
STRING GRAND-TOTALS-LINE
	INTEGER GT-NUM-SOLD
	DOUBLE GT-GRAND-TOTALS
	
0000-MAIN()
	1000-INIT()
	
	DO UNTIL (EOF)
		20000-NORM()
	END-DO
	
	3000-CLOSING()
END-0000-MAIN

1000-INIT()
	OPEN INPUT INPUT1
	OPEN OUTPUT OUTPUT1
	
	PLACE SYSTEM DATE AND TIME IN: (I-DATE, I-TIME)
	
	TITLE-MM = I-MM
	TITLE-DD = I-DD
	TITLE-YYYY = I-YYYY
	
	CALL 9100-READ()
	
	DAT-STATE = I-STATE
	H-BOAT-TYPE = I-BOAT-TYPE
	
	CALL 9200-BOAT-INTERPRET()
	CALL 9300-HEADINGS()
END-1000-INIT

2000-NORM()
	IF I-BOAT-TYPE NOT = DAT-STATE
		CALL 9400-MINOR-BREAK()
		CALL 9500-MAJOR-BREAK()
	ELSE
		IF(H-STATE NOT = I-STATE)
			CALL 9400-MINOR-BREAK()
		END-IF
	END-IF
	
	CALL 2100-CALCS()
	CALL 2200-MAINLINE()
	CALL 9100-READ()
END-2000-NORM

2100-CALCS()
	IF (I-ACCESSORY-PACKAGE = 1)
		DAT-ACCESSORY-PACKAGE = "Electronics"
		COST-ACCESSORY-PACKAGE = 5415.30
	ELSE
		IF (I-ACCESSORY-PACKAGE = 2)
			DAT-ACCESSORY-PACKAGE = "Ski Package"
			COST-ACCESSORY-PACKAGE = 3980
		ELSE
			DAT-ACCESSORY-PACKAGE = "Finishing Package"
			COST-ACCESSORY-PACKAGE = 345.45
		END-IF
	END-IF
	
	C-TOTAL-COST = ([I-BOAT-COST * (1 + C-MARKUP-PRCNT)]+ COST-ACCESSORY-PACKAGE + I-PREP-DELIVER-COST)*(1 + TAX-RATE)
	
	C-MINOR-NUM-SOLD += 1
	C-MINOR-TOTAL-COST += C-TOTAL-COST
END-2100-CALCS
	
2200-MAINLINE()
	DAT-LAST-NAME = I-LAST-NAME
	DAT-BOAT-COST = I-BOAT-COST
	DAT-MM = I-MM
	DAT-DD = I-DD
	DAT-YY = I-YYYY
	DAT-ACCESSORY-PACKAGE = C-ACCESSORY-PACKAGE
	DAT-PREP-DELIVER-COST = I-PREP-DELIVER-COST
	DAT-TOTAL-COST = C-TOTAL-COST
	
	PRINT DATA-LINE
	
	IF (LINE >=  60)
		CALL 9300-HEADINGS()
	END-IF
	
END-2200-MAINLINE()

3000-CLOSING()
	CALL 9400-MINOR-BREAK()
	CALL 9500-MAJOR-BREAK()
	
	GT-NUM-SOLD = C-GT-NUM-SOLD
	GT-TOTAL-COST = C-GT-TOTAL-COST
	
	PRINT BLANK LINE
	PRINT GRAND-TOTALS
END-3000-CLOSING

91000-READ
	READ INPUT1 (I-REC)
	
	IF (NO MORE RECORDS)
		EOF = TRUE
	END-IF
END-9100-READ

9200-BOAT-INTERPRET
	SWITCH I-BOAT-TYPE
		CASE "B"
			MAJOR-BOAT-TYPE = "BASS BOAT"
			C-MARKUP-PRCNT = .33
		CASE "P"
			MAJOR-BOAT-TYPE = "PONTOON"
			C-MARKUP-PRCNT = .25
		CASE "S"
			MAJOR-BOAT-TYPE = "SKI BOAT"
			C-MARKUP-PRCNT = .425
		CASE "J"
			MAJOR-BOAT-TYPE = "JOHN BOAT"
			C-MARKUP-PRCNT = .33
		CASE "C"
			MAJOR-BOAT-TYPE = "CANOE"
			C-MARKUP-PRCNT = .20
		CASE "R"
			MAJOR-BOAT-TYPE = "CABIN CRUISER"
			C-MARKUP-PRCNT = .30
	END-SWITCH
END-9200-BOAT-INTERPRET

9300-HEADINGS
	C-PG-NUM += 1
	GO TO NEW PAGE
	TITLE-PG = C-PG-NUM
	PRINT COMPANY-TITLE-LINE
	PRINT BLANK LINE
	
	PRINT COLUMB-HEADING-LINE1
	PRINT COLUMB-HEADING-LINE2
	LINE = 4
	
	CALL BOAT-HEADING()
END-9300-HEADINGS

9400-MINOR-BREAK()
	MINOR-STATE = DAT-STATE
	MINOR-NUM-SOLD = C-MINOR-NUM-SOLD
	MINOR-TOTAL-COST = C-MINOR-TOTAL-COST
	
	PRINT BLANK LINE
	PRINT BOAT-MINOR-LINE
	PRINT BLANK LINE
	
	LINE +=3
	
	C-GT-NUM-SOLD += C-MINOR-NUM-SOLD
	C-GT-TOTAL-COST += C-MINOR-TOTAL-COST
	
	DAT-STATE = I-STATE
	C-MINOR-NUM-SOLD = 0
	C-MINOR-TOTAL-COST = 0
END-9400-MINOR-BREAK

9500-MAJOR-BREAK()
	MAJOR-NUM-SOLD = C-MAJOR-NUM-SOLD
	MAJOR-TOTAL-COST = C-MAJOR-TOTAL-COST
	
	PRINT BOAT-MAJOR-LINE
	PRINT BLANK LINE
	
	LINE += 2
	
	CALL 9200-BOAT-INTERPRET()
	CALL 9600-BOAT-HEADING()
	
	C-GT-NUM-SOLD += C-MAJOR-NUM-SOLD
	C-GT-TOTAL-COST += C-MAJOR-TOTAL-COST
	
	C-MAJOR-NUM-SOLD = 0
	C-MAJOR-TOTAL-COST = 0
	H-BOAT-TYPE = I-BOAT-TYPE
END-9500-MAJOR-BREAK

9600-BOAT-HEADING 
	BOAT-HEADER = I-BOAT-TYPE
	
	PRINT BOAT-TYPE-HEADER-LINE
	PRINT BLANK LINE
	
	LINE += 2
END-9600-BOAT-HEADING